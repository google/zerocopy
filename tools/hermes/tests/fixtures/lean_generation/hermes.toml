[[test.artifact]]
package = "lean_generation"
target = "lib"
kind = "lean"
should_exist = true

# Verify Build Infrastructure
content_contains = [
    "import Hermes",
    "import «Generated».«lean_generation-lib-main».Funs",
    "import «Generated».«lean_generation-lib-main».Types"
]

[[test.artifact]]
package = "lean_generation"
target = "lib"
kind = "lean"
should_exist = true
content_contains = ["lake-manifest.json"]

# Verify Function Specs
[[test.command]]
args = ["charon", "--opaque", "crate::unsafe_axiom"]

[[test.artifact]]
package = "lean_generation"
target = "lib"
kind = "lean"
should_exist = true
content_contains = [
    "theorem simple_spec_spec",
    "axiom unsafe_axiom_spec",
    "theorem ref_lowering_spec",
    "let old_x := x",
    "let x := x_new"
]

# Verify Type/Trait Invariants
[[test.artifact]]
package = "lean_generation"
target = "lib"
kind = "lean"
should_exist = true
content_contains = [
    "instance : Hermes.IsValid Positive",
    "class SafeTrait",
    "instance {T} [Clone T] : Hermes.IsValid (InlineBound T)",
    "instance {T} [Copy T] : Hermes.IsValid (WhereBound T)"
]


[test]
args = ["verify", "--allow-sorry"]
