description = """
Purpose: Tests holistic Lean lake project emission.
Behavior: Specifically instructs the engine to persist the artifact (`style = lean`). Asserts the presence of critical Lean build assets, e.g. `lake-manifest.json`, the `.lean` files, and properly structured `import` modules.
"""

[test]
expected_status = "known_bug"
args = ["verify", "--allow-sorry"]

[[test.artifact]]
package = "lean_generation"
target = "lean_generation"
kind = "lean"
should_exist = true

# Verify Build Infrastructure
content_contains = [
    "import Hermes",
    "import «Generated».«lean_generation-lib-main».Funs",
    "import «Generated».«lean_generation-lib-main».Types"
]


matches_expected_dir = "expected"
[[test.artifact]]
package = "lean_generation"
target = "lean_generation"
kind = "lean"
should_exist = true
content_contains = ["lake-manifest.json"]

# Verify Function Specs

matches_expected_dir = "expected"
[[test.artifact]]
package = "lean_generation"
target = "lean_generation"
kind = "lean"
should_exist = true
content_contains = [
    "theorem simple_spec_spec",
    "axiom unsafe_axiom_spec",
    "theorem ref_lowering_spec",
    "let old_x := x",
    "let x := x_new"
]

# Verify Type/Trait Invariants

matches_expected_dir = "expected"
[[test.artifact]]
package = "lean_generation"
target = "lean_generation"
kind = "lean"
should_exist = true
content_contains = [
    "instance : Hermes.IsValid Positive",
    "class SafeTrait",
    "instance {T} [Clone T] : Hermes.IsValid (InlineBound T)",
    "instance {T} [Copy T] : Hermes.IsValid (WhereBound T)"
]

matches_expected_dir = "expected"
[[test.command]]
args = ["charon", "--opaque", "crate::unsafe_axiom"]

