---
# Checks if doc comments will have no errors on `docs.rs`.

when:
  - event: [manual, push, tag]

variables:
  rust_nightly_image: &rust_nightly_image 'rustlang/rust:nightly-slim'

clone:
  git:
    image: woodpeckerci/plugin-git
    settings:
      # Custom root CA certificate will be used in some local networks.
      # The global environment variable WP_GIT_SKIP_VERIFY will be
      # set to `true` in such environment.
      skip-verify: ${WP_GIT_SKIP_VERIFY:-false}
      lfs: false

steps:
  - name: doc (docs.rs)
    image: *rust_nightly_image
    commands:
      - export RUSTDOCFLAGS="-D warnings"
      # Workaround to avoid build failure caused by too-old dependencies.
      - cargo update
      - cargo rustdoc --all-features -- --cfg docsrs
